<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.yun.project.dao.IboardDAO">

	<select id="boardCount" parameterType="map" resultType="int">
		SELECT count(*) FROM mbd_board WHERE 1=1
		<choose>
			<when test="schType == 'name'">
				AND user_name like '%'||#{schText}||'%'
			</when>
			<when test="schType == 'title'">
				AND board_title like '%'||#{schText}||'%'
			</when>
			<when test="schType == 'content'">
				AND (
					board_title like '%'||#{schText}||'%'
					OR
					board_content like '%'||#{schText}||'%'
					)
			</when>
		</choose>
		
	</select>

	<!-- 게시판 조회 -->
	<select id="getBoardList" resultType="com.yun.project.dto.Board">
		SELECT * FROM mbd_board ORDER BY board_data DESC
	</select>
	
	<!-- 게시판 불러오기 -->
	<select id="getBoardDetail" resultType="com.yun.project.dto.Board">
		SELECT * FROM mbd_board WHERE board_idx = #{board_idx}
	</select>
	
	<select id="getBoardUserID" resultType="com.yun.project.dto.Board">
		SELECT b.board_idx, b.board_title, b.board_data, a.user_idx, a.user_id
		FROM mbd_board b 
		LEFT JOIN mbd_user a
		ON b.user_idx = a.user_idx
	</select>
	
	<!-- 게시판 작성 -->
	<insert id="insertBoard">
		INSERT INTO mbd_board (board_idx, user_idx, board_title, board_content, board_data)
		VALUES (mbd_board_seq.nextval, #{user_idx}, #{board_title}, #{board_content}, sysdate)
	</insert>
	
	<!-- 게시판 수정 -->
	<update id="updateBoard">
		UPDATE mbd_board SET board_title = #{board_title}, board_content = #{board_content} WHERE board_idx = #{board_idx} AND user_idx =#{user_idx}
	</update>
	
	<!-- 조횟수 표시 -->
	<update id="updateBoardHit">
		update board set board_hit = board_hit+1 WHERE board_idx = #{param1}
	</update>
	
	<!-- 게시판 삭제 -->
	<delete id="deleteBoard">
		DELETE FROM mbd_board WHERE board_idx= ${ board_idx }
	</delete>
	
</mapper>